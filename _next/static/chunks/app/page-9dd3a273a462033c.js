(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{67:function(){},2061:function(){},4687:function(e,t,r){Promise.resolve().then(r.bind(r,3356))},3356:function(e,t,r){"use strict";r.r(t);var a=r(7437),l=r(2265),s=r(7504);t.default=()=>{let[e,t]=(0,l.useState)(""),[r,o]=(0,l.useState)(""),[n,c]=(0,l.useState)([]),[i,m]=(0,l.useState)(""),[d,g]=(0,l.useState)(!1),[u,h]=(0,l.useState)(!1),[f,x]=(0,l.useState)(""),[b,S]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=localStorage.getItem("current_session_id");if(e)x(e);else{let e="session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);localStorage.setItem("current_session_id",e),x(e)}},[]);let getStorageKey=e=>"".concat(f,"_").concat(e);(0,l.useEffect)(()=>{if(!f)return;let e=localStorage.getItem(getStorageKey("registryText")),r=localStorage.getItem(getStorageKey("fullReportText")),a=localStorage.getItem(getStorageKey("filterMatches")),l=localStorage.getItem(getStorageKey("filterTerminated")),s=localStorage.getItem(getStorageKey("isVersionTwo"));if(e&&t(e),r&&o(r),a&&g("true"===a),l&&h("true"===l),s&&S("true"===s),e&&r){let e=localStorage.getItem(getStorageKey("differences"));e?c(JSON.parse(e)):setTimeout(()=>compareData(),100)}},[f]),(0,l.useEffect)(()=>{f&&(localStorage.setItem(getStorageKey("registryText"),e),localStorage.setItem(getStorageKey("fullReportText"),r),localStorage.setItem(getStorageKey("filterMatches"),String(d)),localStorage.setItem(getStorageKey("filterTerminated"),String(u)),localStorage.setItem(getStorageKey("isVersionTwo"),String(b)),n.length>0&&localStorage.setItem(getStorageKey("differences"),JSON.stringify(n)))},[e,r,n,d,u,f,b]);let cleanFIO=e=>e.replace(/\s+/g," ").trim(),parseRegistryText=(e,t)=>{try{let r=e.trim().split("\n").map((e,r)=>{let a=e.split("	");if(t){if(a.length<8)throw Error("Ошибка в строке ".concat(r+1," реестра: неверный формат данных для версии 2. Ожидается минимум 8 колонок."));let e=cleanFIO(a[0]),t=parseSum(a[7].trim());return{ФИО:e,СНИЛС:"",СУММА:t}}{if(9!==a.length)throw Error("Ошибка в строке ".concat(r+1," реестра: неверный формат данных для версии 1. Ожидается 9 колонок."));let e=cleanFIO(a[0]),t=parseSum(a[8].trim());return{ФИО:e,СНИЛС:"",СУММА:t}}});if(t){let e=new Map;return r.forEach(t=>{if(e.has(t.ФИО)){let r=e.get(t.ФИО);r.СУММА+=t.СУММА}else e.set(t.ФИО,{...t})}),Array.from(e.values())}return r}catch(e){return m(e instanceof Error?e.message:"Ошибка при обработке данных реестра"),[]}},parseFullReportText=e=>{try{return e.trim().split("\n").map((e,t)=>{let r=e.split("	").map(e=>e.trim());if(2!==r.length)throw Error("Ошибка в строке ".concat(t+1," полного свода: неверный формат данных. Ожидаются 2 колонки."));return{ФИО:cleanFIO(r[0]),СУММА:parseSum(r[1])}})}catch(e){return m(e instanceof Error?e.message:"Ошибка при обработке данных полного свода"),[]}},parseSum=e=>{if(!e)return 0;let t=e.replace(/\s+/g,"").replace(",",".");return parseFloat(t)},compareData=()=>{if(m(""),!e.trim()||!r.trim()){m("Пожалуйста, заполните оба поля данных");return}try{let t=parseRegistryText(e,b),a=parseFullReportText(r);if(!t.length||!a.length)return;let l=new Map;t.forEach(e=>{l.set(e.ФИО,e.СУММА)});let s=[];a.forEach(e=>{let t=l.get(e.ФИО),r=0,a="";void 0===t?(r=e.СУММА,a="Нет в Реестре"):(r=e.СУММА-t,a=e.СУММА===t?"Совпадает":"Различается"),s.push({ФИО:e.ФИО,Разница:r,Статус:a})}),t.forEach(e=>{let t=a.some(t=>cleanFIO(t.ФИО)===cleanFIO(e.ФИО));t||s.push({ФИО:e.ФИО,Разница:-e.СУММА,Статус:"Нет в Своде"})}),c(s)}catch(e){m(e instanceof Error?e.message:"Произошла ошибка при сравнении данных")}},clearAll=()=>{t(""),o(""),c([]),m(""),localStorage.removeItem(getStorageKey("registryText")),localStorage.removeItem(getStorageKey("fullReportText")),localStorage.removeItem(getStorageKey("differences"))},getSumTotal=()=>n.filter(e=>(!d||"Совпадает"!==e.Статус)&&(!u||"Нет в Реестре"!==e.Статус&&"Нет в Своде"!==e.Статус)).reduce((e,t)=>e+t.Разница,0).toFixed(2);return(0,a.jsxs)("div",{className:"container py-4",children:[(0,a.jsx)("h1",{className:"mb-4",children:"Сравнение Реестра и Полного свода"}),i&&(0,a.jsx)("div",{className:"alert alert-danger mb-4",role:"alert",children:i}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("button",{className:"btn btn-outline-secondary mb-2",onClick:()=>{S(!b),c([]),localStorage.removeItem(getStorageKey("differences")),e.trim()&&r.trim()&&setTimeout(()=>compareData(),100)},children:["Переключить на ",b?"Версия 1 (Реестр: ФИО + 8 колонок, Сумма в 9-й)":"Версия 2 (Реестр: ФИО в 1-й, Сумма в 8-й колонке)"]})}),(0,a.jsxs)("div",{className:"row mb-4",children:[(0,a.jsx)("div",{className:"col-md-6",children:(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{className:"mb-2",children:"Реестр:"}),(0,a.jsx)("div",{className:"d-flex mb-2",children:(0,a.jsx)("button",{className:"btn btn-outline-secondary btn-sm me-2",onClick:()=>{t(""),localStorage.removeItem(getStorageKey("registryText")),r.trim()||(c([]),localStorage.removeItem(getStorageKey("differences")))},children:"Очистить реестр"})}),(0,a.jsx)("textarea",{className:"form-control",rows:6,placeholder:"Вставьте текст Реестра (".concat(b?"ФИО[Tab]...[Tab]Сумма (всего от 8 колонок, ФИО - 1-я, Сумма - 8-я)":"ФИО[Tab]...[Tab]Сумма (всего 9 колонок, ФИО - 1-я, Сумма - 9-я)",")"),value:e,onChange:e=>t(e.target.value)}),(0,a.jsxs)("small",{className:"form-text text-muted",children:["Формат: ",b?"Для версии 2: ФИО - 1-я колонка, Сумма - 8-я колонка. Минимум 8 колонок.":"Для версии 1: ФИО - 1-я колонка, Сумма - 9-я колонка. Всего 9 колонок."]})]})}),(0,a.jsx)("div",{className:"col-md-6",children:(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{className:"mb-2",children:"Полный свод:"}),(0,a.jsx)("div",{className:"d-flex mb-2",children:(0,a.jsx)("button",{className:"btn btn-outline-secondary btn-sm me-2",onClick:()=>{o(""),localStorage.removeItem(getStorageKey("fullReportText")),e.trim()||(c([]),localStorage.removeItem(getStorageKey("differences")))},children:"Очистить полный свод"})}),(0,a.jsx)("textarea",{className:"form-control",rows:6,placeholder:"Вставьте текст Полного свода (ФИО[Tab]Сумма)",value:r,onChange:e=>o(e.target.value)}),(0,a.jsx)("small",{className:"form-text text-muted",children:"Формат: ФИО[Tab]Сумма"})]})})]}),(0,a.jsxs)("div",{className:"mb-4 d-flex flex-wrap",children:[(0,a.jsx)("button",{className:"btn btn-primary me-2 mb-2",onClick:compareData,disabled:!e.trim()||!r.trim(),children:"Сравнить данные"}),(0,a.jsx)("button",{className:"btn btn-outline-danger me-2 mb-2",onClick:clearAll,children:"Очистить все"}),(0,a.jsx)("button",{className:"btn btn-outline-info me-2 mb-2",onClick:()=>{let e="session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);localStorage.setItem("current_session_id",e),x(e),clearAll()},title:"Создать новую сессию для работы с другими данными",children:"Новая сессия"}),(0,a.jsxs)("button",{className:"btn btn-success mb-2",onClick:()=>{try{let e=n.filter(e=>(!d||"Совпадает"!==e.Статус)&&(!u||"Нет в Реестре"!==e.Статус&&"Нет в Своде"!==e.Статус)),t=e.map(e=>({ФИО:e.ФИО,Разница:e.Разница,Статус:e.Статус}));t.push({ФИО:"Итоговая сумма разницы:",Разница:parseFloat(getSumTotal()),Статус:""});let r=s.P6.json_to_sheet(t),a=s.P6.book_new();s.P6.book_append_sheet(a,r,"Сравнение"),r["!cols"]=[{wch:40},{wch:15},{wch:25}];let l=new Date().toISOString().slice(0,10).replace(/-/g,""),o="Сравнение_".concat(l,".xlsx");s.NC(a,o)}catch(e){m(e instanceof Error?e.message:"Ошибка при экспорте в Excel")}},disabled:0===n.length,title:"Сохранить результаты в Excel файл",children:[(0,a.jsx)("i",{className:"bi bi-file-earmark-excel me-1"}),"Экспорт в Excel"]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("button",{className:"btn btn-secondary me-2 mb-2",onClick:()=>g(!d),children:d?"Показать совпадения":"Скрыть совпадения"}),(0,a.jsx)("button",{className:"btn btn-danger mb-2",onClick:()=>h(!u),children:u?"Показать отсутствующие":"Скрыть отсутствующие"})]}),n.length>0&&(0,a.jsx)("div",{className:"table-responsive",children:(0,a.jsxs)("table",{className:"table table-striped table-bordered",children:[(0,a.jsx)("thead",{className:"table-dark",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"ФИО"}),(0,a.jsx)("th",{children:"Разница"}),(0,a.jsx)("th",{children:"Статус"})]})}),(0,a.jsx)("tbody",{children:n.filter(e=>(!d||"Совпадает"!==e.Статус)&&(!u||"Нет в Реестре"!==e.Статус&&"Нет в Своде"!==e.Статус)).map((e,t)=>(0,a.jsxs)("tr",{className:"Нет в Реестре"===e.Статус||"Нет в Своде"===e.Статус?"table-danger":0===e.Разница?"table-success":"table-warning",children:[(0,a.jsx)("td",{children:(0,a.jsx)("input",{type:"text",value:e.ФИО,readOnly:!0,className:"form-control",onClick:e=>e.target.select()})}),(0,a.jsx)("td",{children:(0,a.jsx)("input",{type:"text",value:e.Разница.toFixed(2),readOnly:!0,className:"form-control",onClick:e=>e.target.select()})}),(0,a.jsx)("td",{children:e.Статус})]},t))}),(0,a.jsxs)("tfoot",{children:[(0,a.jsxs)("tr",{className:"table-info",children:[(0,a.jsx)("td",{children:(0,a.jsx)("strong",{children:"Всего записей:"})}),(0,a.jsx)("td",{colSpan:2,children:n.filter(e=>(!d||"Совпадает"!==e.Статус)&&(!u||"Нет в Реестре"!==e.Статус&&"Нет в Своде"!==e.Статус)).length})]}),(0,a.jsxs)("tr",{className:"table-danger",children:[(0,a.jsx)("td",{children:(0,a.jsx)("strong",{children:"Итоговая сумма разницы:"})}),(0,a.jsx)("td",{colSpan:2,children:getSumTotal()})]})]})]})})]})}},622:function(e,t,r){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a=r(2265),l=Symbol.for("react.element"),s=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),o=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,r){var a,c={},i=null,m=null;for(a in void 0!==r&&(i=""+r),void 0!==t.key&&(i=""+t.key),void 0!==t.ref&&(m=t.ref),t)s.call(t,a)&&!n.hasOwnProperty(a)&&(c[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===c[a]&&(c[a]=t[a]);return{$$typeof:l,type:e,key:i,ref:m,props:c,_owner:o.current}}t.jsx=q,t.jsxs=q},7437:function(e,t,r){"use strict";e.exports=r(622)}},function(e){e.O(0,[425,971,472,744],function(){return e(e.s=4687)}),_N_E=e.O()}]);